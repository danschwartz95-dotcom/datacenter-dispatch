<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The DataCenter Dispatch</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
  <style>
    :root {
      --ink: #0f0f0f;
      --paper: #f5f0e8;
      --accent: #c8401a;
      --steel: #2a3a4a;
      --muted: #6b7280;
      --rule: #d4c9b0;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'IBM Plex Sans', sans-serif;
      background: var(--paper);
      color: var(--ink);
      min-height: 100vh;
      background-image: repeating-linear-gradient(
        0deg, transparent, transparent 27px,
        rgba(200,180,150,0.12) 27px, rgba(200,180,150,0.12) 28px
      );
    }

    /* ── MASTHEAD ── */
    .masthead {
      border-bottom: 3px double var(--ink);
      padding: 28px 48px 20px;
      text-align: center;
      background: var(--paper);
    }
    .masthead::before {
      content: '';
      display: block;
      border-top: 1px solid var(--ink);
      margin-bottom: 16px;
    }
    .flag {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 8px;
    }
    .paper-name {
      font-family: 'Playfair Display', serif;
      font-size: clamp(36px, 7vw, 72px);
      font-weight: 900;
      line-height: 1;
      letter-spacing: -1px;
      color: var(--ink);
    }
    .paper-name span { color: var(--accent); }
    .dateline {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      letter-spacing: 0.25em;
      color: var(--muted);
      margin-top: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
    }
    .dateline::before, .dateline::after {
      content: '';
      height: 1px;
      width: 60px;
      background: var(--rule);
    }

    /* ── CONTROLS ── */
    .controls {
      max-width: 860px;
      margin: 0 auto;
      padding: 28px 48px 0;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      background: var(--ink);
      color: var(--paper);
      border: none;
      padding: 14px 30px;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
    }
    .btn:hover:not(:disabled) { background: var(--accent); }
    .btn:active:not(:disabled) { transform: scale(0.98); }
    .btn:disabled { opacity: 0.45; cursor: not-allowed; }

    .spinner {
      width: 13px; height: 13px;
      border: 2px solid rgba(245,240,232,0.3);
      border-top-color: var(--paper);
      border-radius: 50%;
      animation: spin 0.75s linear infinite;
      display: inline-block;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .status {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      color: var(--muted);
      margin-top: 10px;
      letter-spacing: 0.1em;
      min-height: 15px;
    }

    /* ── NEWSLETTER BODY ── */
    .newsletter {
      max-width: 860px;
      margin: 0 auto;
      padding: 32px 48px 80px;
    }

    /* Section dividers */
    .divider {
      display: flex;
      align-items: center;
      gap: 14px;
      margin: 36px 0 26px;
    }
    .divider::before, .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--ink);
    }
    .divider-label {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 0.45em;
      text-transform: uppercase;
      color: var(--muted);
      white-space: nowrap;
    }

    /* Lead / summary block */
    .lead {
      border-top: 4px solid var(--ink);
      padding-top: 22px;
      margin-bottom: 36px;
    }
    .kicker {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 0.35em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 8px;
    }
    .lead-headline {
      font-family: 'Playfair Display', serif;
      font-size: clamp(22px, 3.5vw, 38px);
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 12px;
    }
    .byline {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      color: var(--muted);
      letter-spacing: 0.1em;
      border-left: 3px solid var(--accent);
      padding-left: 10px;
      margin-bottom: 16px;
    }
    .summary-text {
      font-size: 15px;
      line-height: 1.8;
      font-weight: 300;
      color: #1a1a1a;
      column-count: 2;
      column-gap: 36px;
      column-rule: 1px solid var(--rule);
    }

    /* Article cards */
    .article {
      border-top: 1px solid var(--rule);
      padding: 22px 0;
      display: grid;
      grid-template-columns: 1fr 64px;
      gap: 16px;
      align-items: start;
      opacity: 0;
      animation: rise 0.4s ease forwards;
    }
    .article:nth-child(1) { animation-delay: 0.05s; }
    .article:nth-child(2) { animation-delay: 0.10s; }
    .article:nth-child(3) { animation-delay: 0.15s; }
    .article:nth-child(4) { animation-delay: 0.20s; }
    .article:nth-child(5) { animation-delay: 0.25s; }
    .article:nth-child(6) { animation-delay: 0.30s; }
    .article:nth-child(7) { animation-delay: 0.35s; }
    .article:nth-child(8) { animation-delay: 0.40s; }
    @keyframes rise {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .article-meta {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 7px;
    }
    .article-title {
      font-family: 'Playfair Display', serif;
      font-size: 18px;
      font-weight: 700;
      line-height: 1.3;
      margin-bottom: 8px;
    }
    .article-body {
      font-size: 14px;
      line-height: 1.7;
      font-weight: 300;
      color: #2a2a2a;
      margin-bottom: 10px;
    }
    .article-source {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 0.15em;
      color: var(--steel);
      text-decoration: none;
      border-bottom: 1px dotted var(--steel);
    }
    .article-source:hover { color: var(--accent); border-color: var(--accent); }
    .article-num {
      font-family: 'Playfair Display', serif;
      font-size: 44px;
      font-weight: 900;
      color: var(--rule);
      line-height: 1;
      text-align: right;
    }

    /* Empty / error states */
    .idle-state {
      text-align: center;
      padding: 70px 20px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      color: var(--muted);
      letter-spacing: 0.12em;
      line-height: 2;
    }
    .error-box {
      background: #fdf2f0;
      border: 1px solid var(--accent);
      border-left: 4px solid var(--accent);
      padding: 16px 20px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      color: var(--accent);
      line-height: 1.7;
      white-space: pre-wrap;
      word-break: break-word;
    }

    /* Footer */
    .footer {
      border-top: 3px double var(--ink);
      text-align: center;
      padding: 20px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 0.25em;
      color: var(--muted);
      text-transform: uppercase;
    }

    @media (max-width: 620px) {
      .masthead, .controls, .newsletter { padding-left: 20px; padding-right: 20px; }
      .summary-text { column-count: 1; }
      .article { grid-template-columns: 1fr; }
      .article-num { display: none; }
    }
  </style>
</head>
<body>

  <!-- ── MASTHEAD ───────────────────────────────────────────── -->
  <header class="masthead">
    <div class="flag">Automated Intelligence Briefing &nbsp;·&nbsp; U.S. Data Center Monitor</div>
    <div class="paper-name">The Data<span>Center</span> Dispatch</div>
    <div class="dateline" id="dateline">Loading date…</div>
  </header>

  <!-- ── CONTROLS ──────────────────────────────────────────── -->
  <div class="controls">
    <button class="btn" id="generateBtn" onclick="generate()">
      ▶ Generate Today's Edition
    </button>
    <div class="status" id="status"></div>
  </div>

  <!-- ── NEWSLETTER BODY ────────────────────────────────────── -->
  <main class="newsletter" id="newsletter">
    <div class="idle-state">
      Press "Generate Today's Edition" to scan live news<br>
      and compile your data center intelligence briefing.
    </div>
  </main>

  <!-- ── FOOTER ─────────────────────────────────────────────── -->
  <footer class="footer">
    The DataCenter Dispatch &nbsp;·&nbsp; Automated &nbsp;·&nbsp;
    AI-generated summaries from live web sources &nbsp;·&nbsp; For informational purposes only
  </footer>

<script>
  // ══════════════════════════════════════════════════════════════
  //  CONFIGURATION — paste your Anthropic API key below
  // ══════════════════════════════════════════════════════════════
  const ANTHROPIC_API_KEY = "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";
  // ══════════════════════════════════════════════════════════════

  const MODEL = "claude-sonnet-4-20250514";

  // Set today's date in the masthead
  document.getElementById("dateline").textContent =
    new Date().toLocaleDateString("en-US", {
      weekday: "long", year: "numeric", month: "long", day: "numeric"
    }) + " · Powered by Claude AI + Live Web Search";

  function setStatus(msg) {
    document.getElementById("status").textContent = msg;
  }

  function setBtn(loading) {
    const btn = document.getElementById("generateBtn");
    btn.disabled = loading;
    btn.innerHTML = loading
      ? '<span class="spinner"></span> Scanning the wire…'
      : '▶ Generate Today\'s Edition';
  }

  function showError(msg) {
    document.getElementById("newsletter").innerHTML =
      `<div class="error-box">⚠ ${msg}</div>`;
  }

  // ── Prompt ────────────────────────────────────────────────────
  function buildPrompt() {
    return `Today is ${new Date().toDateString()}.

You are a professional technology journalist producing the daily US Data Center Dispatch newsletter. Search the web for news articles published in the past 24-48 hours about new data center developments in the United States.

Search for: new campus announcements, construction starts, expansions, investment rounds, hyperscaler projects (AWS, Azure, Google Cloud, Meta, Oracle, Microsoft), colocation facility openings, power purchase agreements, and land acquisitions.

After searching, return ONLY a raw JSON object — no markdown fences, no explanation, no preamble. Use exactly this structure:

{
  "generated_at": "${new Date().toISOString()}",
  "summary": "2-3 sentence executive overview of today's US data center landscape",
  "articles": [
    {
      "title": "headline",
      "source": "publication name",
      "published": "e.g. Feb 18, 2026 or 3 hours ago",
      "location": "US state or city",
      "category": "Hyperscaler or Colocation or Investment or Policy or Power & Land",
      "summary": "3-4 sentence factual summary of the article",
      "url": "article URL or null"
    }
  ]
}

Include 4-8 of the most significant and recent articles. Your entire response must be only the JSON object — nothing else.`;
  }

  // ── Parse JSON from model response ────────────────────────────
  function parseJSON(text) {
    let s = text.replace(/^```(?:json)?/im, "").replace(/```\s*$/im, "").trim();
    const a = s.indexOf("{");
    const z = s.lastIndexOf("}");
    if (a === -1 || z === -1) throw new Error("No JSON object found in response.");
    const parsed = JSON.parse(s.slice(a, z + 1));
    if (typeof parsed.summary !== "string" || !Array.isArray(parsed.articles)) {
      throw new Error("Response is missing required fields.");
    }
    return parsed;
  }

  // ── Render briefing to HTML ───────────────────────────────────
  function render(briefing) {
    const timeStr = (() => {
      try {
        return new Date(briefing.generated_at).toLocaleTimeString("en-US",
          { hour: "2-digit", minute: "2-digit" });
      } catch { return "just now"; }
    })();

    const articles = briefing.articles.map((a, i) => `
      <div class="article">
        <div>
          <div class="article-meta">${a.category || ""} · ${a.location || ""} · ${a.published || ""}</div>
          <div class="article-title">${a.title || ""}</div>
          <div class="article-body">${a.summary || ""}</div>
          ${a.url
            ? `<a class="article-source" href="${a.url}" target="_blank" rel="noreferrer">${a.source || "Source"} ↗</a>`
            : `<span class="article-source" style="cursor:default">${a.source || ""}</span>`}
        </div>
        <div class="article-num">${String(i + 1).padStart(2, "0")}</div>
      </div>`).join("");

    document.getElementById("newsletter").innerHTML = `
      <div class="divider"><span class="divider-label">Executive Summary</span></div>

      <div class="lead">
        <div class="kicker">Today's Overview · U.S. Data Center Sector</div>
        <div class="lead-headline">Data Center Investment Activity: 24-Hour Intelligence Report</div>
        <div class="byline">Generated ${timeStr} · Live Web Sources</div>
        <div class="summary-text">${briefing.summary}</div>
      </div>

      <div class="divider">
        <span class="divider-label">Developing Stories · ${briefing.articles.length} Reports</span>
      </div>

      ${articles}`;
  }

  // ── Main generate function ────────────────────────────────────
  async function generate() {
    if (!ANTHROPIC_API_KEY || ANTHROPIC_API_KEY === "YOUR_API_KEY_HERE") {
      showError(
        "API key not set.\n\n" +
        "Open this file in a text editor, find the line:\n" +
        "  const ANTHROPIC_API_KEY = \"YOUR_API_KEY_HERE\";\n\n" +
        "Replace YOUR_API_KEY_HERE with your Anthropic API key, save the file, and refresh."
      );
      return;
    }

    setBtn(true);
    setStatus("Connecting to Anthropic API…");
    document.getElementById("newsletter").innerHTML =
      '<div class="idle-state">Searching the web for today\'s data center news…<br>This takes about 20-30 seconds.</div>';

    try {
      setStatus("Searching live news sources…");

      const res = await fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: {
          "Content-Type":    "application/json",
          "x-api-key":       ANTHROPIC_API_KEY,
          "anthropic-version": "2023-06-01",
          "anthropic-beta":  "web-search-2025-03-05",
          "anthropic-dangerous-direct-browser-access": "true",
        },
        body: JSON.stringify({
          model: MODEL,
          max_tokens: 4000,
          tools: [{ type: "web_search_20250305", name: "web_search", max_uses: 5 }],
          messages: [{ role: "user", content: buildPrompt() }],
        }),
      });

      setStatus("Processing results…");
      const payload = await res.json();

      if (!res.ok) {
        throw new Error(payload?.error?.message || `API error ${res.status}`);
      }

      // Extract text from response (web_search runs server-side; response arrives in one shot)
      const text = (payload.content || [])
        .filter(b => b.type === "text")
        .map(b => b.text)
        .join("")
        .trim();

      if (!text) {
        throw new Error(
          `No text in API response.\nstop_reason: ${payload.stop_reason}\n` +
          `Block types: [${(payload.content || []).map(b => b.type).join(", ")}]`
        );
      }

      setStatus("Rendering briefing…");
      const briefing = parseJSON(text);
      render(briefing);
      setStatus("");

    } catch (err) {
      showError(err.message || "An unexpected error occurred.");
      setStatus("");
    } finally {
      setBtn(false);
    }
  }
</script>
</body>
</html>
